<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/images/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Inter:300,600,700,900" rel="stylesheet">
    <title>Biblioteca</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
        }
        .container {
            width: 80%;
            margin: auto;
            max-height: 100vh; /* Altura máxima é a altura da janela de visualização */
            overflow-y: auto; /* Adiciona uma barra de rolagem vertical se necessário */
            padding: 20px 0; /* Adiciona um espaço de 20px no topo e no rodapé */
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px; /* Ajuste este valor para o espaço desejado */
            margin-bottom: 70px; /* Adiciona uma margem de 20px na parte inferior do container */
            text-align: center;
            max-width: 800px;
        }
        .container p {
            text-align: center; /* Centraliza o texto */
            font-weight: bold; /* Deixa o texto em negrito */
            color: #333;
            margin-left: 5%;
            margin-right: 5%;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-top: 0px;
        }
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            font-weight: bold; /* Torna a fonte dos botões mais grossa */
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 80px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #45a049;
        }
        header {
            background-color: #003C85;
            color: #fff;
            padding: 2px 0;
            display: flex;
            justify-content: center; /* Centraliza horizontalmente os itens */
            align-items: center; /* Alinha verticalmente os itens */
            width: 100%;
            text-align: center;
        }
        header img {
            height: 50px; /* Ajuste este valor para o tamanho desejado */
            margin: 0.5% 0; /* Adiciona uma margem de 5% para cima e para baixo */
        }
        p {
            margin: 20px 0;
        }

        label {
            margin: 10px 0;
            font-weight: bold;
            color: #003C85;
            margin-bottom: 0px
        }
        form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        select {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: calc(100% - 22px);
            max-width: 15%;
        }
        input {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: calc(100% - 22px);
            max-width: 40%;
        }
        .stripe {
            height: 5px; /* Ajuste este valor para a altura desejada */
            width: 100%;
        }
        .yellow-stripe {
            background-color: #F4C511;
        }
        .red-stripe {
            background-color: #D02729;
        }
        .black-stripe {
            height: 2px; /* Ajuste este valor para a altura desejada */
            width: 80%;
            background-color: #85858586;
            margin: 0 auto; 
        }
        header h2 {
            margin: auto; /* Centraliza o título */
        }
        footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 0.001% 0; /* Reduz o padding para diminuir a altura */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <header>
        <img src="/images/escola.png" alt="Logo">
    </header>
    <div class="stripe yellow-stripe"></div>
    <div class="stripe red-stripe"></div>

    <div class="container">
        <h1>Biblioteca</h1>
        <form id="addBookForm">
            <h2>Adicionar Livro</h2>
            <input type="number" id="codigo" placeholder="Código" required>
            <input type="text" id="titulo" placeholder="Título" required>
            <input type="text" id="autor" placeholder="Autor" required>
            <input type="checkbox" id="disponivel" checked> Disponível
            <button type="submit" class="button">Adicionar Livro</button>
        </form>

        <form id="loanBookForm">
            <h2>Registrar Empréstimo</h2>
            <input type="number" id="loanCodigo" placeholder="Código do Livro" required>
            <button type="submit" class="button">Registrar Empréstimo</button>
        </form>

        <form id="returnBookForm">
            <h2>Registrar Devolução</h2>
            <input type="number" id="returnCodigo" placeholder="Código do Livro" required>
            <button type="submit" class="button">Registrar Devolução</button>
        </form>

        <h2>Livros</h2>
        <table>
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Título</th>
                    <th>Autor</th>
                    <th>Disponibilidade</th>
                </tr>
            </thead>
            <tbody id="booksList">
            </tbody>
        </table>
    </div>

    <footer>
        <p>© 2024 Eliseu Rodrigues. Todos os direitos reservados.</p>
    </footer>

    <script>
        document.getElementById('addBookForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const codigo = document.getElementById('codigo').value;
            const titulo = document.getElementById('titulo').value;
            const autor = document.getElementById('autor').value;
            const disponivel = document.getElementById('disponivel').checked;
            const response = await fetch('/books', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ codigo, titulo, autor, disponivel })
            });
            if (response.status === 201) {
                const book = await response.json();
                console.log('Livro adicionado:', book);
                document.getElementById('addBookForm').reset(); // Limpar campos do formulário
            } else {
                const error = await response.json();
                alert(error.message);
            }
            loadBooks();
        });

        document.getElementById('loanBookForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const codigo = document.getElementById('loanCodigo').value;
            const response = await fetch(`/books/${codigo}/loan`, {
                method: 'POST'
            });
            if (response.status === 200) {
                alert('Empréstimo registrado');
                document.getElementById('loanBookForm').reset(); // Limpar campos do formulário
            } else if (response.status === 404) {
                alert('Livro não existe');
            } else if (response.status === 409) {
                alert('Livro não disponível para empréstimo');
            } else {
                alert('Erro desconhecido');
            }
            loadBooks();
        });

        document.getElementById('returnBookForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const codigo = document.getElementById('returnCodigo').value;
            const response = await fetch(`/books/${codigo}/return`, {
                method: 'POST'
            });
            if (response.status === 200) {
                alert('Devolução registrada');
                document.getElementById('returnBookForm').reset(); // Limpar campos do formulário
            } else {
                alert('Erro ao registrar devolução');
            }
            loadBooks();
        });

        async function loadBooks() {
            const response = await fetch('/books');
            const books = await response.json();
            const booksList = document.getElementById('booksList');
            booksList.innerHTML = '';
            books.forEach(book => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${book.codigo}</td>
                    <td>${book.titulo}</td>
                    <td>${book.autor}</td>
                    <td>${book.disponivel ? 'Disponível' : 'Indisponível'}</td>
                `;
                booksList.appendChild(tr);
            });
        }

        loadBooks();
    </script>
</body>
</html>